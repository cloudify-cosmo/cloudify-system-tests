# Variables specified here can be accessed in
# inputs_override/manager_blueprint_override/external/files dict values
# using `{{variable_name}}` syntax
variables:

  datacentred_openstack_ubuntu_precise_image_name: Ubuntu 12.04
  datacentred_openstack_ubuntu_trusty_image_name: Ubuntu 14.04
  datacentred_openstack_ubuntu_precise: 2f91391d-ff21-4410-a063-d4e947845980
  datacentred_openstack_ubuntu_trusty: 6c3047c6-17b1-4aaf-a657-9229bb481e50
  datacentred_openstack_centos_6_5_image_name: CentOS 6.6 dccloud
  datacentred_openstack_centos_7_image_name: CentOS 7.2
  datacentred_openstack_centos_7_image_id: ebab03e6-a674-4b6e-8f60-691c90fbcdc6
  datacentred_openstack_windows_image_name: Windows Server 2012 R2 Standard
  datacentred_openstack_windows_image_id: 07a93cc5-b3f1-499b-a7f2-ab420526ae1f

  rackspace_openstack_ubuntu_precise_image_name: ???
  rackspace_openstack_ubuntu_trusty_image_name: 'Ubuntu 14.04.1 LTS Trusty Tahr (cloudimg)'
  rackspace_openstack_ubuntu_precise: ???
  rackspace_openstack_ubuntu_trusty: e41430f7-9131-495b-927f-e7dc4b8994c8
  rackspace_openstack_centos_6_5_image_name: 'centos_6.6'
  rackspace_openstack_centos_7_image_name: 'CentOS-7-x86_64-GenericCloud-1608'
  rackspace_openstack_centos_7_image_id: c76d5b15-bf64-4402-bea6-9f4957ac0c6d
  rackspace_openstack_windows_image_name: ???
  rackspace_openstack_windows_image_id: ???

  ubuntu_image_user: ubuntu
  rhel_7_image_user: ec2-user
  aws_ec2_eu_central_1_ami_ubuntu_trusty_image_id: ami-00dae61d
  aws_ec2_eu_central_1_ami_centos_7_image_id: ami-e68f82fb
  aws_ec2_eu_central_1_windows_server_2012_r2_image_id: ami-0c34ca63
  aws_ec2_eu_west_1_ami_rhel_7_image_id: ami-25158352
  aws_ec2_frankfurt_rhel_7_image_id: ami-dafdcfc7
  aws_ec2_frankfurt_rhel_65_image_id: ami-12ccfa0f
  aws_ec2_large_instance_type: m3.large
  aws_ec2_medium_instance_type: m3.medium
  aws_ec2_micro_instance_type: t2.micro
  aws_ec2_eu_central_1_region_name: eu-central-1
  aws_ec2_eu_central_1b_availability_zone: eu-central-1b
  aws_ec2_eu_central_1_domain_name: eu-central-1.compute.internal
  aws_ec2_windows_user: Administrator

  vcloud_service_type: ondemand
  vcloud_instance: 7f26733b-b8c5-4621-ae28-6033cd465b79
  vcloud_url: https://vca.vmware.com

  azure_resource_suffix: 0
  azure_resource_prefix: sys
  azure_location_westus: westus
  azure_location_westeu: westeurope
  azure_size_standard_a2: Standard_A2
  azure_size_standard_a3: Standard_A3
  azure_os_family_linux: linux
  azure_os_ubuntu_username: ubuntu
  azure_os_ubuntu_authorized_keys: /home/ubuntu/.ssh/authorized_keys
  azure_os_ubuntu_trusty_image_publisher: Canonical
  azure_os_ubuntu_trusty_image_offer: UbuntuServer
  azure_os_ubuntu_trusty_image_sku: 14.04.4-LTS
  azure_os_ubuntu_trusty_image_version: 14.04.201604060
  azure_os_centos_username: centos
  azure_os_centos_authorized_keys: /home/centos/.ssh/authorized_keys
  azure_os_centos_final_image_publisher: OpenLogic
  azure_os_centos_final_image_offer: CentOS
  azure_os_centos_final_image_sku: '7.0'
  azure_os_centos_final_image_version: latest
  azure_os_family_windows: windows
  azure_os_windows_username: cloudify
  azure_os_microsoft_image_publisher: MicrosoftWindowsServer
  azure_os_microsoft_image_offer: WindowsServer
  azure_os_microsoft_image_sku: 2012-R2-Datacenter
  azure_os_microsoft_image_version: latest

  ######################################################

  # These values are updated by the version tool
  core_branch: '4.0m8'

  # These values are injected by quickbuild and are here mainly
  # for reference (i.e. they will exist in runtime either way)
  # If you happen to use a new variable, kindly add its name here
  # as well.
  system_tests_branch: _

  system_tests_shared_key: _
  system_tests_shared_public: _

  cloudify_automation_token: _

  ubuntu_package_agent_url: _
  windows_package_agent_url: _
  centos_package_agent_url: _
  docker_image_url: _
  windows_cli_package_url: _
  rhel_centos_cli_package_url: _

  system_tests_datacentred_os_username: _
  system_tests_datacentred_os_password: _

  system_tests_rackspace_os_username: _
  system_tests_rackspace_os_password: _

  system_tests_aws_access_key_id: _
  system_tests_aws_secret_access_key: _

  system_test_vsphere_username: _
  system_test_vsphere_password: _
  system_test_vsphere_url: _
  system_test_vsphere_vcenter_name: _

  system_test_vcloud_username: _
  system_test_vcloud_password: _

  system_tests_azure_subscription_id: _
  system_tests_azure_tenant_id: _
  system_tests_azure_client_id: _
  system_tests_azure_client_secret: _
  system_tests_azure_manager_password: _

#####################################################################################

# The name `templates` is arbitrary. This is simply
# A place holders for configuring YAMl anchors (&)
# That can later be used by YAML aliases (*) and merges (<<)
templates:

  - &manager_blueprint_override
#    node_templates.manager.properties.cloudify_packages.agents.ubuntu_agent_url: '{{ubuntu_package_agent_url}}'
#    node_templates.manager.properties.cloudify_packages.agents.centos_agent_url: '{{centos_package_agent_url}}'
#    node_templates.manager.properties.cloudify_packages.agents.windows_agent_url: '{{windows_package_agent_url}}'
#    node_templates.manager.properties.cloudify_packages.docker.docker_url: '{{docker_image_url}}'
    node_templates.manager.properties.cloudify.workflows.task_retries: 20
    node_templates.manager.properties.cloudify.workflows.subgraph_retries: 2

  - &new_manager_blueprint_override
    node_templates.manager_configuration.properties.cloudify.workflows.task_retries: 20
    node_templates.manager_configuration.properties.cloudify.workflows.subgraph_retries: 2

  - &manager_blueprint_commercial_override
    <<: *manager_blueprint_override
    # override packages derived from 'manager_blueprint_override' with commercial ones
    node_templates.manager.properties.cloudify_packages.docker.docker_url: '{{docker_image_commercial_url}}'
    # node_templates.manager.properties.cloudify_packages.agents.ubuntu_agent_url: '{{ubuntu_package_agent_commercial_url}}'

  - &openstack_manager_blueprint_sg_override
    'node_templates.management_security_group.properties.rules[append]':
      port: 8086
      remote_ip_prefix: 0.0.0.0/0

  - &aws_ec2_manager_blueprint_sg_override
    'node_templates.management_security_group.properties.rules[append]':
      ip_protocol: tcp
      from_port: 8086
      to_port: 8086
      cidr_ip: 0.0.0.0/0

  - &vcloud_manager_blueprint_sg_override
    'node_templates.manager_security_group.properties.rules[append]':
      source: external
      destination: internal
      destination_port: 8086
      action: allow
      protocol: TCP

  - &vcloud_manager_blueprint_pi_override
    'node_templates.manager_public_ip.properties.rules[append]':
      type: DNAT
      protocol: tcp
      original_port: 8086
      translated_port: 8086

  - &openstack_manager_blueprint_override
    <<: *new_manager_blueprint_override
    <<: *openstack_manager_blueprint_sg_override

  - &datacentred_openstack_manager_blueprint_override
    <<: *openstack_manager_blueprint_override
    node_templates.management_subnet.properties.subnet.dns_nameservers: [8.8.4.4, 8.8.8.8]

  - &aws_ec2_manager_blueprint_override
    <<: *new_manager_blueprint_override
    <<: *aws_ec2_manager_blueprint_sg_override

  - &vcloud_manager_blueprint_override
    <<: *new_manager_blueprint_override
    <<: *vcloud_manager_blueprint_sg_override
    <<: *vcloud_manager_blueprint_pi_override

  - &azure_manager_blueprint_sg_override
    'node_templates.network_security_group.properties.resource_config.securityRules[append]':
      name: influx_monitoring
      properties:
        description: influx
        protocol: Tcp
        sourcePortRange: '*'
        destinationPortRange: 8086
        sourceAddressPrefix: 0.0.0.0/0
        destinationAddressPrefix: '*'
        priority: 600
        access: Allow
        direction: Inbound

  ######################################################

  - &openstack_plugin_external
    repo: cloudify-openstack-plugin
    branch: '1.5'

  - &vsphere_plugin_external
    repo: cloudify-vsphere-plugin
    private: true
    username: opencm
    password: '{{opencm_git_pwd}}'
    branch: '1.4'

  - &diamond_snmp_extension_external
    repo: cloudify-diamond-snmp-extension
    branch: '{{core_branch}}'

  - &psutil_plugin_external
    repo: cloudify-psutil-plugin
    branch: '1.0.2'

  - &docker_plugin_external
    repo: cloudify-docker-plugin
    branch: '1.3.2'

  - &host_pool_plugin_external
    repo: cloudify-host-pool-plugin
    branch: '1.4'

  - &aws_ec2_plugin_external
    repo: cloudify-aws-plugin
    branch: '1.4.3'

  - &vcloud_plugin_external
    repo: tosca-vcloud-plugin
    branch: '1.3.1'

  - &chef_plugin_external
    repo: cloudify-chef-plugin
    branch: '1.3.1'

  - &puppet_plugin_external
    repo: cloudify-puppet-plugin
    branch: '1.3.1'

  - &azure_plugin_external
    repo: cloudify-azure-plugin
    branch: '1.4'

  #######################################################

  - &install_python_compilers_input_override
    install_python_compilers: 'true'

  #######################################################

  - &datacentred_openstack_credentials_inputs
    keystone_username: '{{system_tests_datacentred_os_username}}'
    keystone_password: '{{system_tests_datacentred_os_password}}'

  - &rackspace_openstack_credentials_inputs
    keystone_username: '{{system_tests_rackspace_os_username}}'
    keystone_password: '{{system_tests_rackspace_os_password}}'

  #######################################################

  - &datacentred_openstack_inputs
    image_id: '{{datacentred_openstack_centos_7_image_id}}'

  - &rackspace_openstack_inputs
    image_id: '{{rackspace_openstack_centos_7_image_id}}'

  #######################################################

  - &openstack_handler_configuration
    handler: openstack_handler
    external: *openstack_plugin_external

  - &datacentred_openstack_handler_configuration
    <<: *openstack_handler_configuration
    inputs: inputs-datacentred-openstack.yaml
    manager_blueprint: openstack-manager-blueprint.yaml
    manager_blueprint_override: *datacentred_openstack_manager_blueprint_override
    properties: datacentred_openstack_properties

  - &rackspace_openstack_handler_configuration
    <<: *openstack_handler_configuration
    inputs: inputs-rackspace-openstack.yaml
    manager_blueprint: openstack-manager-blueprint.yaml
    manager_blueprint_override: *openstack_manager_blueprint_override
    properties: rackspace_openstack_properties

#####################################################################################

handler_properties:

  datacentred_openstack_properties:
    ubuntu_image_user: '{{ubuntu_image_user}}'
    ubuntu_precise_image_name: '{{datacentred_openstack_ubuntu_precise_image_name}}'
    ubuntu_trusty_image_name: '{{datacentred_openstack_ubuntu_trusty_image_name}}'
    ubuntu_precise_image_id: '{{datacentred_openstack_ubuntu_precise}}'
    ubuntu_trusty_image_id: '{{datacentred_openstack_ubuntu_trusty}}'
    centos_image_name: '{{datacentred_openstack_centos_6_5_image_name}}'
    centos_image_user: centos
    centos_7_image_name: '{{datacentred_openstack_centos_7_image_name}}'
    centos_7_image_id: '{{datacentred_openstack_centos_7_image_id}}'
    centos_7_image_user: centos
    windows_image_name: '{{datacentred_openstack_windows_image_name}}'
    windows_image_id: '{{datacentred_openstack_windows_image_id}}'
    flavor_name: dc1.2x2.40
    small_flavor_id: c4b193d2-f331-4250-9b15-bbfde97c462a
    medium_flavor_id: d87de0ca-9c0e-4759-a704-8621883c3415

  rackspace_openstack_properties:
    ubuntu_image_user: '{{ubuntu_image_user}}'
    ubuntu_precise_image_name: '{{rackspace_openstack_ubuntu_precise_image_name}}'
    ubuntu_trusty_image_name: '{{rackspace_openstack_ubuntu_trusty_image_name}}'
    ubuntu_precise_image_id: '{{rackspace_openstack_ubuntu_precise}}'
    ubuntu_trusty_image_id: '{{rackspace_openstack_ubuntu_trusty}}'
    centos_image_name: '{{rackspace_openstack_centos_6_5_image_name}}'
    centos_image_user: centos
    centos_7_image_name: '{{rackspace_openstack_centos_7_image_name}}'
    centos_7_image_id: '{{rackspace_openstack_centos_7_image_id}}'
    centos_7_image_user: centos
    windows_image_name: '{{rackspace_openstack_windows_image_name}}'
    windows_image_id: '{{rackspace_openstack_windows_image_id}}'
    flavor_name: m1.large
    small_flavor_id: 2
    medium_flavor_id: 4

  vsphere_handler_props:
    template: systemtests-ubuntu-1404
    agent_user: giga
    execution_timeout: 3600

  vcloud_handler_props:
    catalog: Public Catalog
    ubuntu_precise_template: Ubuntu Server 12.04 LTS (amd64 20150127)

  aws_ec2:
    ubuntu_trusty_image_id: '{{aws_ec2_eu_central_1_ami_ubuntu_trusty_image_id}}'
    centos_7_image_id: '{{aws_ec2_eu_central_1_ami_centos_7_image_id}}'
    rhel_7_image_id: '{{aws_ec2_frankfurt_rhel_7_image_id}}'
    rhel_65_image_id: '{{aws_ec2_frankfurt_rhel_65_image_id}}'
    windows_server_2012_r2_image_id: '{{aws_ec2_eu_central_1_windows_server_2012_r2_image_id}}'
    windows_server_2012_user: '{{aws_ec2_windows_user}}'
    large_instance_type: '{{aws_ec2_large_instance_type}}'
    medium_instance_type: '{{aws_ec2_medium_instance_type}}'
    micro_instance_type: '{{aws_ec2_micro_instance_type}}'
    ubuntu_image_user:  '{{ubuntu_image_user}}'
    rhel_7_image_user: '{{rhel_7_image_user}}'
    availability_zone: '{{aws_ec2_eu_central_1b_availability_zone}}'
    ec2_domain_name: '{{aws_ec2_eu_central_1_domain_name}}'

  azure:
    resource_prefix: '{{azure_resource_prefix}}'
    resource_suffix: '{{azure_resource_suffix}}'
    location: '{{azure_location_westeu}}'
    keydata: '{{system_tests_shared_public}}'
    standard_a2_size: '{{azure_size_standard_a2}}'
    os_family_linux: '{{azure_os_family_linux}}'
    username_ubuntu_trusty: '{{azure_os_ubuntu_username}}'
    authorized_keys_ubuntu: '{{azure_os_ubuntu_authorized_keys}}'
    image_publisher_ubuntu_trusty: '{{azure_os_ubuntu_trusty_image_publisher}}'
    image_offer_ubuntu_trusty: '{{azure_os_ubuntu_trusty_image_offer}}'
    image_sku_ubuntu_trusty: '{{azure_os_ubuntu_trusty_image_sku}}'
    image_version_ubuntu_trusty: '{{azure_os_ubuntu_trusty_image_version}}'
    username_centos_final: '{{azure_os_centos_username}}'
    authorized_keys_centos: '{{azure_os_centos_authorized_keys}}'
    image_publisher_centos_final: '{{azure_os_centos_final_image_publisher}}'
    image_offer_centos_final: '{{azure_os_centos_final_image_offer}}'
    image_sku_centos_final: '{{azure_os_centos_final_image_sku}}'
    image_version_centos_final: '{{azure_os_centos_final_image_version}}'
    os_family_windows: '{{azure_os_family_windows}}'
    username_windows: '{{azure_os_windows_username}}'
    image_publisher_windows: '{{azure_os_microsoft_image_publisher}}'
    image_offer_windows: '{{azure_os_microsoft_image_offer}}'
    image_sku_windows: '{{azure_os_microsoft_image_sku}}'
    image_version_windows: '{{azure_os_microsoft_image_version}}'

#####################################################################################

handler_configurations:

  datacentred_openstack_system_tests1:
    <<: *datacentred_openstack_handler_configuration
    env: datacentred_openstack_1
    tags: [openstack, datacentred]
    inputs_override:
      <<: *datacentred_openstack_credentials_inputs
      <<: *datacentred_openstack_inputs
      keystone_tenant_name: gigaspaces_system-test-1

  datacentred_openstack_system_tests2:
    <<: *datacentred_openstack_handler_configuration
    env: datacentred_openstack_2
    tags: [openstack, datacentred]
    inputs_override:
      <<: *datacentred_openstack_credentials_inputs
      <<: *datacentred_openstack_inputs
      keystone_tenant_name: gigaspaces_system-test-2

  datacentred_openstack_system_tests3:
    <<: *datacentred_openstack_handler_configuration
    env: datacentred_openstack_3
    tags: [openstack, datacentred]
    inputs_override:
      <<: *datacentred_openstack_credentials_inputs
      <<: *datacentred_openstack_inputs
      keystone_tenant_name: gigaspaces_system-test-3

  datacentred_openstack_system_tests4:
    <<: *datacentred_openstack_handler_configuration
    env: datacentred_openstack_4
    tags: [openstack, datacentred]
    inputs_override:
      <<: *datacentred_openstack_credentials_inputs
      <<: *datacentred_openstack_inputs
      keystone_tenant_name: gigaspaces_system-test-4

  datacentred_openstack_system_tests5:
    <<: *datacentred_openstack_handler_configuration
    env: datacentred_openstack_5
    tags: [openstack, datacentred]
    inputs_override:
      <<: *datacentred_openstack_credentials_inputs
      <<: *datacentred_openstack_inputs
      keystone_tenant_name: gigaspaces_system-test-5

  datacentred_openstack_system_tests6:
    <<: *datacentred_openstack_handler_configuration
    env: datacentred_openstack_6
    tags: [openstack, datacentred]
    inputs_override:
      <<: *datacentred_openstack_credentials_inputs
      <<: *datacentred_openstack_inputs
      keystone_tenant_name: gigaspaces_system-test-6

  datacentred_openstack_system_tests7:
    <<: *datacentred_openstack_handler_configuration
    env: datacentred_openstack_7
    tags: [openstack, datacentred]
    inputs_override:
      <<: *datacentred_openstack_credentials_inputs
      <<: *datacentred_openstack_inputs
      keystone_tenant_name: gigaspaces_system-test-7

  datacentred_openstack_system_tests8:
    <<: *datacentred_openstack_handler_configuration
    env: datacentred_openstack_8
    tags: [openstack, datacentred]
    inputs_override:
      <<: *datacentred_openstack_credentials_inputs
      <<: *datacentred_openstack_inputs
      keystone_tenant_name: gigaspaces_system-test-8

  ###############################################################################

  rackspace_openstack_system_tests1:
    <<: *rackspace_openstack_handler_configuration
    env: rackspace_openstack_1
    tags: [openstack, rackspace]
    inputs_override:
      <<: *rackspace_openstack_credentials_inputs
      <<: *rackspace_openstack_inputs
      keystone_tenant_name: system-tests-1

  rackspace_openstack_system_tests2:
    <<: *rackspace_openstack_handler_configuration
    env: rackspace_openstack_2
    tags: [openstack, rackspace]
    inputs_override:
      <<: *rackspace_openstack_credentials_inputs
      <<: *rackspace_openstack_inputs
      keystone_tenant_name: system-tests-2

  rackspace_openstack_system_tests3:
    <<: *rackspace_openstack_handler_configuration
    env: rackspace_openstack_3
    tags: [openstack, rackspace]
    inputs_override:
      <<: *rackspace_openstack_credentials_inputs
      <<: *rackspace_openstack_inputs
      keystone_tenant_name: system-tests-3

  rackspace_openstack_system_tests4:
    <<: *rackspace_openstack_handler_configuration
    env: rackspace_openstack_4
    tags: [openstack, rackspace]
    inputs_override:
      <<: *rackspace_openstack_credentials_inputs
      <<: *rackspace_openstack_inputs
      keystone_tenant_name: system-tests-4

  rackspace_openstack_system_tests5:
    <<: *rackspace_openstack_handler_configuration
    env: rackspace_openstack_5
    tags: [openstack, rackspace]
    inputs_override:
      <<: *rackspace_openstack_credentials_inputs
      <<: *rackspace_openstack_inputs
      keystone_tenant_name: system-tests-5

  ###############################################################################

  vsphere_handler_config:
    inputs: inputs-vsphere.yaml
    handler: vsphere_handler
    env: vsphere
    external: *vsphere_plugin_external
    manager_blueprint: manager_blueprint/vsphere-manager-blueprint.yaml
    properties: vsphere_handler_props
    manager_blueprint_override: *manager_blueprint_commercial_override
    inputs_override:
      vsphere_username: '{{system_test_vsphere_username}}'
      vsphere_password: '{{system_test_vsphere_password}}'
      vsphere_host: '{{system_test_vsphere_url}}'
      vsphere_datacenter_name: '{{system_test_vsphere_vcenter_name}}'
      vsphere_resource_pool_name: 'system_tests'
      manager_server_template: 'systemtests-ubuntu-1404'

  ###############################################################################

  vcloud_handler_config:
    inputs: inputs-vcloud.yaml
    handler: vcloud_handler
    env: vcloud
    external: *vcloud_plugin_external
    manager_blueprint: vcloud-manager-blueprint.yaml
    properties: vcloud_handler_props
    manager_blueprint_override: *vcloud_manager_blueprint_override
    inputs_override:
      vcloud_username: '{{system_test_vcloud_username}}'
      vcloud_password: '{{system_test_vcloud_password}}'
      vcloud_service_type: '{{vcloud_service_type}}'
      vcloud_instance: '{{vcloud_instance}}'
      vcloud_url: '{{vcloud_url}}'

  ################################################################################

  aws_ec2:
    inputs: inputs-aws-ec2.yaml
    handler: ec2_handler
    env: aws_ec2
    external: *aws_ec2_plugin_external
    manager_blueprint: aws-ec2-manager-blueprint.yaml
    manager_blueprint_override: *aws_ec2_manager_blueprint_override
    properties: aws_ec2
    inputs_override:
      aws_access_key_id: '{{system_tests_aws_access_key_id}}'
      aws_secret_access_key: '{{system_tests_aws_secret_access_key}}'
      image_id: '{{aws_ec2_eu_central_1_ami_centos_7_image_id}}'
      instance_type: '{{aws_ec2_large_instance_type}}'
      ec2_region_name: '{{aws_ec2_eu_central_1_region_name}}'
      minimum_required_total_physical_memory_in_mb: 2048

  ################################################################################

  azure:
    handler: azure_handler
    env: azure
    external: *azure_plugin_external
    properties: azure
    inputs: inputs-azure.yaml
    manager_blueprint: azure-manager-blueprint.yaml
    manager_blueprint_override: *azure_manager_blueprint_sg_override
    inputs_override:
      resource_prefix: '{{azure_resource_prefix}}'
      resource_suffix: '{{azure_resource_suffix}}'
      subscription_id: '{{system_tests_azure_subscription_id}}'
      tenant_id: '{{system_tests_azure_tenant_id}}'
      client_id: '{{system_tests_azure_client_id}}'
      client_secret: '{{system_tests_azure_client_secret}}'
      location: '{{azure_location_westeu}}'
      vm_size: '{{azure_size_standard_a3}}'
      vm_os_family: '{{azure_os_family_linux}}'
      vm_image_publisher: '{{azure_os_centos_final_image_publisher}}'
      vm_image_offer: '{{azure_os_centos_final_image_offer}}'
      vm_image_sku: '{{azure_os_centos_final_image_sku}}'
      vm_image_version: '{{azure_os_centos_final_image_version}}'
      vm_os_username: '{{azure_os_centos_username}}'
      vm_os_password: '{{system_tests_azure_manager_password}}'
      vm_os_pubkeys[0].path: '{{azure_os_centos_authorized_keys}}'
      vm_os_pubkeys[0].keyData: '{{system_tests_shared_public}}'

################################################################################

tests:

  openstack_blueprints:
    tests:
      - cosmo_tester/test_suites/test_blueprints

  chef:
    external: *chef_plugin_external
    tests:
      - system_tests/manager
      - system_tests/local

  puppet:
    external: *puppet_plugin_external
    tests:
      - system_tests/manager
      - system_tests/local

  snapshots_tests:
    tests:
      - cosmo_tester/test_suites/test_snapshots -e test_hello_world_on*

  openstack_blueprints_nodecellar:
      tests:
        - cosmo_tester/test_suites/test_blueprints/nodecellar_test.py

  openstack_blueprints_autoheal_and_scale:
    tests:
        - cosmo_tester/test_suites/test_blueprints/nodecellar_test_autoheal.py
        - cosmo_tester/test_suites/test_blueprints/nodecellar_test_scale.py

  manager_recovery:
    tests:
      - cosmo_tester/test_suites/test_manager_recovery

  openstack_plugin:
    tests:
      - cosmo_tester/test_suites/test_openstack_plugin

  simple_manager_blueprint:
    tests:
      - cosmo_tester/test_suites/test_simple_manager_blueprint

  external_components:
    tests:
      - cosmo_tester/test_suites/test_external_components

  openstack_nova_net:
    tests:
      - cosmo_tester/test_suites/test_openstack_nova_net

  ec2:
    external: *aws_ec2_plugin_external
    tests:
      - system_tests/manager
      - system_tests/local

  azure:
    external: *azure_plugin_external
    tests:
      - system_tests/manager
      - system_tests/local

  vsphere_blueprints:
    external: *vsphere_plugin_external
    tests:
      - system_tests/test_vsphere_blueprints

  vcloud_blueprints:
    external: *vcloud_plugin_external
    tests:
      - system_tests/manager

  active_dir_authentication:
    tests:
      - cosmo_tester/test_suites/test_security/ad_auth_test.py

  psutil_plugin:
    external: *psutil_plugin_external
    tests:
      - system_tests

  cli_packager_windows:
    tests:
      - cosmo_tester/test_suites/cli/test_windows_bootstrap.py

  cli_packager_centos:
    tests:
      - cosmo_tester/test_suites/cli/test_centos6_5_bootstrap.py
      - cosmo_tester/test_suites/cli/test_centos7_bootstrap.py

  cli_packager_rhel:
    tests:
      - cosmo_tester/test_suites/cli/test_rhel_bootstrap.py

  cli_packager_debian:
    tests:
      - cosmo_tester/test_suites/cli/test_ubuntu_bootstrap.py

  diamond_snmp_extension:
    external: *diamond_snmp_extension_external
    tests:
      - system_tests

  docker_plugin:
    external: *docker_plugin_external
    tests:
      - system_tests/manager

  host_pool_plugin:
    external: *host_pool_plugin_external
    tests:
      - system_tests/manager

  nodecellar_backwards_compatibility_tests:
    tests:
      - cosmo_tester/test_suites/backwards/test_nodecellar_backwards_compatibility

  manager_rollback:
    tests:
      - cosmo_tester/test_suites/test_manager_upgrade/rollback_idempotency_test.py

  manager_upgrade:
    tests:
      - cosmo_tester/test_suites/test_manager_upgrade/manager_upgrade_test.py
      - cosmo_tester/test_suites/test_manager_upgrade/upgrade_idempotency_test.py

  manager_upgrade_validations:
    tests:
      - cosmo_tester/test_suites/test_preupgrade_validations

  deployment_update:
    tests:
      - cosmo_tester/test_suites/test_deployment_update/deployment_update_test.py:DeploymentUpdateOSTest

  agent_tests:
    tests:
      - cosmo_tester/test_suites/agent

#####################################################################################

test_suites:

  openstack_blueprints:
    requires: [openstack, rackspace]
    tests:
      - openstack_blueprints

  host_pool_plugin:
    requires: [openstack, rackspace]
    tests:
      - host_pool_plugin

  openstack_manager_status:
    requires: [openstack, rackspace]
    tests:
      - manager_status

  openstack_manager_recovery:
    requires: [openstack, rackspace]
    tests:
      - manager_recovery

  openstack_maintenance_mode:
    requires: [openstack, rackspace]
    tests:
      - maintenance_mode

  openstack_manager_upgrade:
    requires: [openstack, rackspace]
    tests:
      - manager_upgrade

  openstack_manager_rollback:
    requires: [openstack, rackspace]
    tests:
      - manager_rollback

  openstack_manager_upgrade_validations:
    requires: [openstack, rackspace]
    tests:
      - manager_upgrade_validations

  openstack_deployment_update:
    requires: [openstack, rackspace]
    tests:
    - deployment_update

  agent:
    requires: [openstack, rackspace]
    tests:
      - agent_tests

  openstack_plugin:
    requires: [openstack, rackspace]
    tests:
      - openstack_plugin

  openstack_simple_manager:
    requires: [openstack, rackspace]
    tests:
      - simple_manager_blueprint

  openstack_chef:
    requires: [openstack, rackspace]
    tests:
      - chef

  openstack_puppet:
    requires: [openstack, rackspace]
    tests:
      - puppet

  snapshots:
    requires: [openstack, rackspace]
    tests:
      - snapshots_tests

  diamond_snmp:
    requires: [openstack, rackspace]
    tests:
      - diamond_snmp_extension

  external_components:
    requires: [openstack, rackspace]
    tests:
      - external_components

  ec2_security:
    handler_configuration: aws_ec2
    tests:
      - active_dir_authentication

  docker_plugin:
    requires: [openstack, rackspace]
    tests:
      - docker_plugin

  psutil_plugin:
    handler_configuration: aws_ec2
    tests:
      - psutil_plugin

  ec2_windows_cli_package:
    handler_configuration: aws_ec2
    tests:
      - cli_packager_windows

  openstack_centos_cli_package:
    requires: [openstack, rackspace]
    tests:
      - cli_packager_centos

  ec2_rhel_cli_package:
    handler_configuration: aws_ec2
    tests:
      - cli_packager_rhel

  ec2_ubuntu_cli_package:
    handler_configuration: aws_ec2
    tests:
      - cli_packager_debian

  openstack_backwards_nodecellar:
    requires: [openstack, rackspace]
    tests:
      - nodecellar_backwards_compatibility_tests

  vsphere:
    handler_configuration: vsphere_handler_config
    tests:
      - vsphere_blueprints

  vcloud:
    handler_configuration: vcloud_handler_config
    tests:
      - vcloud_blueprints

  ec2:
    handler_configuration: aws_ec2
    tests:
      - ec2

  azure:
    handler_configuration: azure
    tests:
      - azure

# these files are created on the client container before executing the tests
# only applies in quickbuild runs, not when running locally
files:
  '~/.ssh/shared-systemt-tests-key.pem':
    content: '{{system_tests_shared_key}}'
    chmod: 0600
